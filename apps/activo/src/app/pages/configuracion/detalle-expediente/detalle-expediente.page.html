<ion-header>
  <ion-toolbar color="secondary">
    <ion-buttons slot="start">
      <ion-button [routerLink]="'/herramientas/listado-expedientes'">
        <ion-icon name="arrow-back" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Detalle del expediente</ion-title>
    <ion-buttons slot="end">
      <ion-button color="light" fill="clear" *ngIf="actualizandoSap === true">
        Actualizando desde SAP
        <ion-spinner class="ion-margin-horizontal"></ion-spinner>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content color="light">
  <ion-grid fixed *ngIf="(cargando$ | async) || true; else cargado">
    <ion-row>
      <ion-col size="7">
        <ng-container *ngIf="header$ | async as header; else loadingHeader">
          <indelpro-contraloria-expediente-header-tarjeta
            [header]="header"
          ></indelpro-contraloria-expediente-header-tarjeta>
        </ng-container>
        <ng-template #loadingHeader>
          <ion-card>
            <ion-skeleton-text
              animated
              style="height: 310px;"
              class="ion-no-margin"
            ></ion-skeleton-text>
          </ion-card>
        </ng-template>
      </ion-col>
      <ion-col size="5">
        <ng-container *ngIf="fotos$ | async as fotos; else loadingFotos">
          <ion-card *ngIf="fotos.length > 0; else sinFotos" class="fotos">
            <ion-slides>
              <ion-slide *ngFor="let foto of fotos">
                <img [src]="foto.archivo | upload" />
              </ion-slide>
            </ion-slides>
          </ion-card>
          <ng-template #sinFotos>
            <ion-card>
              <ion-card-header>
                <ion-card-title>
                  Sin fotos
                </ion-card-title>
                <ion-card-subtitle>
                  El expediente no cuenta con fotografías capturadas en el
                  sistema
                </ion-card-subtitle>
              </ion-card-header>
            </ion-card>
          </ng-template>
        </ng-container>
        <ng-template #loadingFotos>
          <ion-card>
            <ion-skeleton-text
              animated
              style="height: 310px;"
              class="ion-no-margin"
            ></ion-skeleton-text>
          </ion-card>
        </ng-template>
      </ion-col>
    </ion-row>
    <ion-row>
      <ion-col size="12">
        <ng-container
          *ngIf="expediente$ | async as expediente; else loadingAutorizacion"
        >
          <ion-card>
            <ion-item
              tappable="true"
              button
              color="primary"
              (click)="autorizacionVisible = !autorizacionVisible"
            >
              Autorización del proyecto
              <ion-icon
                slot="end"
                [name]="autorizacionVisible ? 'chevron-down-outline' : 'chevron-back-outline'"
              ></ion-icon>
            </ion-item>
          </ion-card>
        </ng-container>

        <ng-template #loadingAutorizacion>
          <ion-card>
            <ion-skeleton-text
              animated
              style="height: 40px;"
              class="ion-no-margin"
            ></ion-skeleton-text>
          </ion-card>
        </ng-template>
      </ion-col>
    </ion-row>
    <ion-row>
      <ion-col size="12">
        <ng-container *ngIf="det$ | async as det; else loadingDet">
          <ion-card>
            <ion-item
              tappable="true"
              button
              color="primary"
              (click)="detalleVisible = !detalleVisible"
            >
              Detalle del expediente
              <ion-icon
                slot="end"
                [name]="detalleVisible ? 'chevron-down-outline' : 'chevron-back-outline'"
              ></ion-icon>
            </ion-item>

            <div *ngIf="detalleVisible === true">
              <ngx-datatable
                class="material"
                [rows]="det"
                [rowHeight]="50"
                [columns]="columns"
                [columnMode]="'force'"
                [sortType]="'multi'"
                [scrollbarH]="true"
                [headerHeight]="50"
                [footerHeight]="50"
              >
              </ngx-datatable>
            </div>
          </ion-card>
        </ng-container>
        <ng-template #loadingDet>
          <ion-card>
            <ion-skeleton-text
              animated
              style="height: 40px;"
              class="ion-no-margin"
            ></ion-skeleton-text>
          </ion-card>
        </ng-template>
      </ion-col>
    </ion-row>
    <ion-row>
      <ion-col size="12">
        <ng-container
          *ngIf="expediente$ | async as expediente; else loadingCapitalizacion"
        >
          <ion-card>
            <ion-item
              tappable="true"
              button
              color="primary"
              (click)="capitalizacionVisible = !capitalizacionVisible"
            >
              Autorización de capitalización
              <ion-icon
                slot="end"
                [name]="capitalizacionVisible ? 'chevron-down-outline' : 'chevron-back-outline'"
              ></ion-icon>
            </ion-item>
          </ion-card>
        </ng-container>
        <ng-template #loadingCapitalizacion>
          <ion-card>
            <ion-skeleton-text
              animated
              style="height: 40px;"
              class="ion-no-margin"
            ></ion-skeleton-text>
          </ion-card>
        </ng-template>
      </ion-col>
    </ion-row>
  </ion-grid>

  <ng-template #cargado>
    <ion-grid fixed *ngIf="expediente$ | async as activo">
      <ion-row>
        <ion-col size="6">
          <ion-card>
            <ion-slides pager>
              <ion-slide>
                <img src="https://via.placeholder.com/500x350" />
              </ion-slide>
              <ion-slide>
                <img src="https://via.placeholder.com/500x350" />
              </ion-slide>
              <ion-slide>
                <img src="https://via.placeholder.com/500x350" />
              </ion-slide>
            </ion-slides>
          </ion-card>
          <ion-card color="secondary">
            <ion-button fill="clear" expand="full" color="light">
              <ion-icon name="camera" slot="start"></ion-icon>
              Subir foto
            </ion-button>
          </ion-card>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col>
          <ion-card>
            <ion-item
              tappable="true"
              button
              color="primary"
              (click)="autorizacionVisible = !autorizacionVisible"
            >
              Autorización del proyecto
              <ion-icon
                slot="end"
                [name]="autorizacionVisible ? 'chevron-down-outline' : 'chevron-back-outline'"
              ></ion-icon>
            </ion-item>
          </ion-card>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col> </ion-col>
      </ion-row>
      <ion-row>
        <ion-col> </ion-col>
      </ion-row>
    </ion-grid>
  </ng-template>
</ion-content>
