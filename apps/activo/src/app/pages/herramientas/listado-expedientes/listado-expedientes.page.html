<ion-header>
  <ion-toolbar color="secondary">
    <ion-title>Listado de Expedientes</ion-title>
  </ion-toolbar>
  <ion-toolbar color="secondary">
    <ion-searchbar
      placeholder="Buscar entre los registros"
      (ionChange)="buscar($event)"
    ></ion-searchbar>
  </ion-toolbar>
</ion-header>

<ion-content color="light">
  <ng-container *ngIf="(loading$ | async) === true; else datos">
    <ion-grid>
      <ion-row class="ion-justify-content-center">
        <ion-col size="auto" class="ion-padding ion-margin">
          <ion-spinner></ion-spinner>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ng-container>

  <ng-template #datos>
    <ion-grid>
      <ion-row>
        <ion-col size="12">
          <ion-card>
            <ion-item
              button
              lines="full"
              *ngFor="let expediente of resultados$ | async"
              [routerLink]="'/herramientas/listado-expedientes/' + expediente._id"
            >
              <ion-chip color="secondary" slot="end" *ngIf="expediente.AKTIV">
                {{expediente.AKTIV | date:'dd/MM/yyyy'}}
              </ion-chip>
              <ion-chip slot="start" color="tertiary">
                <ion-text>
                  {{expediente.PROJK}}
                </ion-text>
              </ion-chip>
              <ion-label>
                <h2><strong>{{expediente.NAME1}}</strong></h2>
                <p>{{expediente.TXT50}}</p>
              </ion-label>
            </ion-item>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>
    <ion-grid *ngIf="expedientes$ | async as expedientes" fixed>
      <ion-row *ngIf="expedientes.length === 0;else listado">
        <ion-col>
          <ion-card>
            <ion-item lines="none">
              <ion-icon
                name="alert-circle-outline"
                color="danger"
                slot="start"
              ></ion-icon>
              <ion-label>
                <strong>No hay expedientes registrados en el sistema</strong>
              </ion-label>
            </ion-item>
          </ion-card>
        </ion-col>
      </ion-row>
      <ng-template #listado>
        <ion-row class="ion-justify-content-center ion-align-items-center">
          <ion-col size="auto">
            <ion-button
              (click)="regresarPagina()"
              shape="round"
              size="small"
              [disabled]="(paginaActual$ | async) === 1"
            >
              <ion-icon name="chevron-back-outline" slot="icon-only"></ion-icon>
            </ion-button>
          </ion-col>
          <ion-col size="auto">
            <ion-chip>
              {{(paginaActual$ | async)}} / {{(totalExpedientes$ | async) |
              number:'1.0-0'}}
            </ion-chip>
          </ion-col>
          <ion-col size="auto">
            <ion-button
              (click)="avanzarPagina()"
              shape="round"
              size="small"
              [disabled]="(paginaActual$ | async) === (totalExpedientes$ | async)"
            >
              <ion-icon
                name="chevron-forward-outline"
                slot="icon-only"
              ></ion-icon>
            </ion-button>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col>
            <ion-card>
              <ion-item
                button
                lines="full"
                *ngFor="let expediente of expedientes"
                [routerLink]="'/herramientas/listado-expedientes/' + expediente._id"
              >
                <ion-chip color="secondary" slot="end" *ngIf="expediente.AKTIV">
                  {{expediente.AKTIVÂ | date:'dd/MM/yyyy'}}
                </ion-chip>
                <ion-chip slot="start" color="tertiary">
                  <ion-text>
                    {{expediente.PROJK}}
                  </ion-text>
                </ion-chip>
                <ion-label>
                  <h2><strong>{{expediente.NAME1}}</strong></h2>
                  <p>{{expediente.TXT50}}</p>
                </ion-label>
              </ion-item>
            </ion-card>
          </ion-col>
        </ion-row>
        <ion-row class="ion-justify-content-center ion-align-items-center">
          <ion-col size="auto">
            <ion-button
              (click)="regresarPagina()"
              shape="round"
              size="small"
              [disabled]="(paginaActual$ | async) === 1"
            >
              <ion-icon name="chevron-back-outline" slot="icon-only"></ion-icon>
            </ion-button>
          </ion-col>
          <ion-col size="auto">
            <ion-chip>
              {{(paginaActual$ | async)}} / {{(totalExpedientes$ | async) |
              number:'1.0-0'}}
            </ion-chip>
          </ion-col>
          <ion-col size="auto">
            <ion-button
              (click)="avanzarPagina()"
              shape="round"
              size="small"
              [disabled]="(paginaActual$ | async) === (totalExpedientes$ | async)"
            >
              <ion-icon
                name="chevron-forward-outline"
                slot="icon-only"
              ></ion-icon>
            </ion-button>
          </ion-col>
        </ion-row>
      </ng-template>
    </ion-grid>
  </ng-template>
</ion-content>
